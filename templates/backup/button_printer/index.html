<!-- templates/button_printer/index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <div id="status" class="status connecting">è¿æ¥ä¸­...</div>
    <div id="version" class="version">{{ title }} v{{ version }}</div>

    <div id="controller-container">
        <div class="background-image"></div>
        <div id="buttons-container"></div>
    </div>

    <script>
        console.log("=== æ•°æ®ä¼ é€’è°ƒè¯•å¼€å§‹ ===");

        // æ–¹æ³•1ï¼šç›´æ¥ä½¿ç”¨æ¨¡æ¿å˜é‡
        console.log("1. åŸå§‹æ¨¡æ¿å˜é‡:", "{{ buttons_data_json|escapejs }}");

        // æ–¹æ³•2ï¼šå®‰å…¨è§£æ
        let BUTTONS_DATA = [];
        try {
            const rawJsonString = "{{ buttons_data_json|escapejs }}";
            console.log("2. è½¬ä¹‰åçš„JSONå­—ç¬¦ä¸²:", rawJsonString);
            console.log("3. å­—ç¬¦ä¸²é•¿åº¦:", rawJsonString.length);

            if (rawJsonString && rawJsonString !== "None" && rawJsonString.length > 0) {
                BUTTONS_DATA = JSON.parse(rawJsonString);
                console.log("4. è§£ææˆåŠŸ:", BUTTONS_DATA);
            } else {
                console.warn("5. JSONå­—ç¬¦ä¸²ä¸ºç©ºæˆ–æ— æ•ˆ");
            }
        } catch (error) {
            console.error("6. JSONè§£æé”™è¯¯:", error);
            console.error("7. é”™è¯¯è¯¦æƒ…:", error.message);
        }

        console.log("8. æœ€ç»ˆ BUTTONS_DATA:", BUTTONS_DATA);
        console.log("9. BUTTONS_DATA é•¿åº¦:", BUTTONS_DATA.length);
        console.log("10. BUTTONS_DATA ç±»å‹:", typeof BUTTONS_DATA);
        console.log("11. æ˜¯å¦ä¸ºæ•°ç»„:", Array.isArray(BUTTONS_DATA));

        const WEBSOCKET_URL = '{{ websocket_url }}';
        console.log("12. WebSocket URL:", WEBSOCKET_URL);
        console.log('=== é¡µé¢åŠ è½½è°ƒè¯•ä¿¡æ¯ ===');
        console.log('ğŸ“Š BUTTONS_DATA:', BUTTONS_DATA);
        console.log('ğŸ“Š BUTTONS_DATA é•¿åº¦:', BUTTONS_DATA ? BUTTONS_DATA.length : 0);
        console.log('ğŸ”— WEBSOCKET_URL:', WEBSOCKET_URL);
    </script>

    <script src="{% static 'js/hid-controller.js' %}"></script>
</body>
</html>